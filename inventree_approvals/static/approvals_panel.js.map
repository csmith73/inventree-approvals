{"version":3,"file":"approvals_panel.js","sources":["../frontend/src/ApprovalHistory.tsx","../frontend/src/ApprovalModals.tsx","../frontend/src/ApprovalsPanel.tsx","../frontend/src/index.tsx"],"sourcesContent":["import { Badge, Table, Text, Stack } from '@mantine/core';\nimport type { Approval, ApprovalStatus } from './types';\n\ninterface ApprovalHistoryProps {\n  approvals: Approval[];\n}\n\n/**\n * Get badge color and text for approval status\n */\nfunction getStatusBadge(status: ApprovalStatus): { color: string; label: string } {\n  switch (status) {\n    case 'approved':\n      return { color: 'green', label: '‚úì Approved' };\n    case 'rejected':\n      return { color: 'red', label: '‚úó Rejected' };\n    case 'pending':\n      return { color: 'yellow', label: '‚è≥ Pending' };\n    default:\n      return { color: 'gray', label: status };\n  }\n}\n\n/**\n * Format date string for display\n */\nfunction formatDate(dateStr: string | null): string {\n  if (!dateStr) return '-';\n  try {\n    return new Date(dateStr).toLocaleString();\n  } catch {\n    return dateStr;\n  }\n}\n\n/**\n * Component to display approval history in a table\n */\nexport function ApprovalHistory({ approvals }: ApprovalHistoryProps) {\n  if (approvals.length === 0) {\n    return (\n      <Text c=\"dimmed\" fs=\"italic\" size=\"sm\">\n        No approvals yet\n      </Text>\n    );\n  }\n\n  const rows = approvals.map((approval, index) => {\n    const { color, label } = getStatusBadge(approval.status);\n    \n    return (\n      <Table.Tr key={index}>\n        <Table.Td>Level {approval.level}</Table.Td>\n        <Table.Td>\n          <Badge color={color} variant=\"filled\" size=\"sm\">\n            {label}\n          </Badge>\n        </Table.Td>\n        <Table.Td>{approval.requested_by_name || '-'}</Table.Td>\n        <Table.Td>\n          {approval.status === 'pending'\n            ? approval.requested_approver_name || 'Any'\n            : approval.actual_approver_name || '-'}\n        </Table.Td>\n        <Table.Td>\n          <Text size=\"xs\" c=\"dimmed\">\n            {formatDate(approval.requested_at)}\n          </Text>\n        </Table.Td>\n        <Table.Td>\n          <Text size=\"xs\" c=\"dimmed\">\n            {approval.status !== 'pending' ? formatDate(approval.decided_at) : '-'}\n          </Text>\n        </Table.Td>\n      </Table.Tr>\n    );\n  });\n\n  return (\n    <Stack gap=\"xs\">\n      <Text fw={500} size=\"sm\">Approval History</Text>\n      <Table striped highlightOnHover withTableBorder withColumnBorders>\n        <Table.Thead>\n          <Table.Tr>\n            <Table.Th>Level</Table.Th>\n            <Table.Th>Status</Table.Th>\n            <Table.Th>Requested By</Table.Th>\n            <Table.Th>Approver</Table.Th>\n            <Table.Th>Requested</Table.Th>\n            <Table.Th>Decided</Table.Th>\n          </Table.Tr>\n        </Table.Thead>\n        <Table.Tbody>{rows}</Table.Tbody>\n      </Table>\n    </Stack>\n  );\n}\n","import { useState, useEffect } from 'react';\nimport {\n  Modal,\n  Button,\n  Select,\n  Textarea,\n  Stack,\n  Group,\n  LoadingOverlay,\n  Alert,\n} from '@mantine/core';\nimport { IconAlertCircle } from '@tabler/icons-react';\nimport type { InvenTreePluginContext } from '@inventreedb/ui';\nimport type {\n  ApproverUser,\n  ApproverUsersResponse,\n  RequestApprovalResponse,\n  ApprovalDecisionResponse,\n} from './types';\n\ninterface RequestModalProps {\n  opened: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  orderId: number;\n  pluginSlug: string;\n  isHighValue: boolean;\n  context: InvenTreePluginContext;\n}\n\n/**\n * Modal for requesting an approval\n */\nexport function RequestApprovalModal({\n  opened,\n  onClose,\n  onSuccess,\n  orderId,\n  pluginSlug,\n  isHighValue,\n  context,\n}: RequestModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [approvers, setApprovers] = useState<ApproverUser[]>([]);\n  const [selectedApprover, setSelectedApprover] = useState<string | null>(null);\n  const [notes, setNotes] = useState('');\n\n  // Fetch available approvers when modal opens\n  useEffect(() => {\n    if (opened) {\n      setError(null);\n      loadApprovers();\n    }\n  }, [opened]);\n\n  async function loadApprovers() {\n    try {\n      const params = isHighValue ? '?is_high_value=true' : '';\n      const response = await context.api?.get(\n        `plugin/${pluginSlug}/users/${params}`\n      );\n      const data = response?.data as ApproverUsersResponse;\n      setApprovers(data?.results || []);\n    } catch (err) {\n      console.error('Failed to load approvers:', err);\n      setApprovers([]);\n    }\n  }\n\n  async function handleSubmit() {\n    setLoading(true);\n    setError(null);\n\n    try {\n      const response = await context.api?.post(\n        `plugin/${pluginSlug}/po/${orderId}/request/`,\n        {\n          approver_id: selectedApprover,\n          notes: notes,\n        }\n      );\n      const data = response?.data as RequestApprovalResponse;\n\n      if (data?.success) {\n        setNotes('');\n        setSelectedApprover(null);\n        onSuccess();\n        onClose();\n      } else {\n        setError(data?.error || 'Failed to request approval');\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  // Build select options\n  const approverOptions = [\n    { value: '', label: '-- Any Available Approver --' },\n    ...(!isHighValue ? [{ value: 'teams_channel', label: 'üì¢ Teams Purchasing Channel' }] : []),\n    ...approvers.map((user) => ({\n      value: String(user.id),\n      label: `${user.full_name} (${user.username})`,\n    })),\n  ];\n\n  return (\n    <Modal opened={opened} onClose={onClose} title=\"Request Approval\" size=\"md\">\n      <LoadingOverlay visible={loading} />\n      \n      <Stack gap=\"md\">\n        {error && (\n          <Alert color=\"red\" icon={<IconAlertCircle size={16} />}>\n            {error}\n          </Alert>\n        )}\n\n        <Select\n          label=\"Select Approver (optional)\"\n          placeholder=\"Select an approver\"\n          data={approverOptions}\n          value={selectedApprover}\n          onChange={setSelectedApprover}\n          clearable\n        />\n\n        <Textarea\n          label=\"Notes (optional)\"\n          placeholder=\"Add any notes for the approver\"\n          value={notes}\n          onChange={(e) => setNotes(e.currentTarget.value)}\n          rows={3}\n        />\n\n        <Group justify=\"flex-end\" gap=\"sm\">\n          <Button variant=\"default\" onClick={onClose}>\n            Cancel\n          </Button>\n          <Button onClick={handleSubmit} loading={loading}>\n            Submit Request\n          </Button>\n        </Group>\n      </Stack>\n    </Modal>\n  );\n}\n\ninterface DecisionModalProps {\n  opened: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  orderId: number;\n  pluginSlug: string;\n  isApprove: boolean;\n  context: InvenTreePluginContext;\n}\n\n/**\n * Modal for approving or rejecting a request\n */\nexport function ApprovalDecisionModal({\n  opened,\n  onClose,\n  onSuccess,\n  orderId,\n  pluginSlug,\n  isApprove,\n  context,\n}: DecisionModalProps) {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [notes, setNotes] = useState('');\n\n  useEffect(() => {\n    if (opened) {\n      setError(null);\n      setNotes('');\n    }\n  }, [opened]);\n\n  async function handleSubmit() {\n    setLoading(true);\n    setError(null);\n\n    try {\n      const endpoint = isApprove ? 'approve' : 'reject';\n      const response = await context.api?.post(\n        `plugin/${pluginSlug}/po/${orderId}/${endpoint}/`,\n        { notes }\n      );\n      const data = response?.data as ApprovalDecisionResponse;\n\n      if (data?.success) {\n        setNotes('');\n        onSuccess();\n        onClose();\n      } else {\n        setError(data?.error || `Failed to ${isApprove ? 'approve' : 'reject'}`);\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  const title = isApprove ? 'Approve Request' : 'Reject Request';\n  const buttonColor = isApprove ? 'green' : 'red';\n  const buttonText = isApprove ? 'Approve' : 'Reject';\n\n  return (\n    <Modal opened={opened} onClose={onClose} title={title} size=\"md\">\n      <LoadingOverlay visible={loading} />\n      \n      <Stack gap=\"md\">\n        {error && (\n          <Alert color=\"red\" icon={<IconAlertCircle size={16} />}>\n            {error}\n          </Alert>\n        )}\n\n        <Textarea\n          label=\"Notes (optional)\"\n          placeholder={`Add any notes for ${isApprove ? 'approving' : 'rejecting'} this request`}\n          value={notes}\n          onChange={(e) => setNotes(e.currentTarget.value)}\n          rows={3}\n        />\n\n        <Group justify=\"flex-end\" gap=\"sm\">\n          <Button variant=\"default\" onClick={onClose}>\n            Cancel\n          </Button>\n          <Button color={buttonColor} onClick={handleSubmit} loading={loading}>\n            {buttonText}\n          </Button>\n        </Group>\n      </Stack>\n    </Modal>\n  );\n}\n","import { useState, useEffect, useCallback } from 'react';\nimport {\n  Stack,\n  Group,\n  Badge,\n  Button,\n  Alert,\n  Loader,\n  Paper,\n  Text,\n} from '@mantine/core';\nimport {\n  IconCheck,\n  IconX,\n  IconAlertTriangle,\n  IconFileDescription,\n} from '@tabler/icons-react';\nimport type { InvenTreePluginContext } from '@inventreedb/ui';\nimport { ApprovalHistory } from './ApprovalHistory';\nimport { RequestApprovalModal, ApprovalDecisionModal } from './ApprovalModals';\nimport type { ApprovalStatusResponse, ApprovalsPluginCustomContext } from './types';\n\ninterface ApprovalsPanelProps {\n  context: InvenTreePluginContext;\n}\n\n/**\n * Main Approvals Panel component\n */\nexport function ApprovalsPanel({ context }: ApprovalsPanelProps) {\n  // Get custom context data passed from the backend\n  const customContext = context.context as ApprovalsPluginCustomContext;\n  const orderId = customContext?.order_id || (context.id as number);\n  const pluginSlug = customContext?.plugin_slug || 'approvals';\n\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [status, setStatus] = useState<ApprovalStatusResponse | null>(null);\n\n  // Modal states\n  const [requestModalOpen, setRequestModalOpen] = useState(false);\n  const [approveModalOpen, setApproveModalOpen] = useState(false);\n  const [rejectModalOpen, setRejectModalOpen] = useState(false);\n\n  /**\n   * Fetch approval status from the API using context.api\n   */\n  const fetchStatus = useCallback(async () => {\n    if (!orderId) {\n      setError('No order ID provided');\n      setLoading(false);\n      return;\n    }\n\n    try {\n      setLoading(true);\n      setError(null);\n      \n      // Use context.api for authenticated API calls\n      const response = await context.api?.get(`plugin/${pluginSlug}/po/${orderId}/status/`);\n      setStatus(response?.data as ApprovalStatusResponse);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load approval status');\n    } finally {\n      setLoading(false);\n    }\n  }, [orderId, pluginSlug, context.api]);\n\n  // Fetch status on mount and when orderId changes\n  useEffect(() => {\n    fetchStatus();\n  }, [fetchStatus]);\n\n  /**\n   * Handle successful approval action\n   */\n  const handleSuccess = useCallback(() => {\n    fetchStatus();\n  }, [fetchStatus]);\n\n  // Loading state\n  if (loading && !status) {\n    return (\n      <Stack align=\"center\" p=\"md\">\n        <Loader size=\"md\" />\n        <Text size=\"sm\" c=\"dimmed\">Loading approval status...</Text>\n      </Stack>\n    );\n  }\n\n  // Error state\n  if (error && !status) {\n    return (\n      <Alert color=\"red\" title=\"Error\" icon={<IconAlertTriangle size={16} />}>\n        {error}\n      </Alert>\n    );\n  }\n\n  if (!status) {\n    return (\n      <Alert color=\"yellow\" title=\"No Data\">\n        Unable to load approval status\n      </Alert>\n    );\n  }\n\n  // Determine status badge color and text\n  let statusColor: string;\n  let statusText: string;\n  \n  if (status.is_fully_approved) {\n    statusColor = 'green';\n    statusText = '‚úì Approved';\n  } else if (status.has_pending) {\n    statusColor = 'yellow';\n    statusText = `${status.approved_count}/${status.total_required} (Pending)`;\n  } else {\n    statusColor = 'blue';\n    statusText = `${status.approved_count}/${status.total_required}`;\n  }\n\n  return (\n    <Stack gap=\"md\" p=\"md\">\n      {/* Header with status badge */}\n      <Group justify=\"space-between\" align=\"center\">\n        <Text fw={600} size=\"lg\">Approval Status</Text>\n        <Badge color={statusColor} variant=\"filled\" size=\"lg\">\n          {statusText}\n        </Badge>\n      </Group>\n\n      {/* High value warning */}\n      {status.is_high_value && (\n        <Alert \n          color=\"orange\" \n          icon={<IconAlertTriangle size={16} />}\n          title=\"High Value Order\"\n        >\n          This order requires approval from a senior approver\n        </Alert>\n      )}\n\n      {/* Approval history */}\n      <ApprovalHistory approvals={status.approvals} />\n\n      {/* Action buttons */}\n      <Group gap=\"sm\">\n        {status.can_request_approval && (\n          <Button\n            leftSection={<IconFileDescription size={16} />}\n            onClick={() => setRequestModalOpen(true)}\n          >\n            Request Approval\n          </Button>\n        )}\n\n        {status.user_can_approve && (\n          <>\n            <Button\n              color=\"green\"\n              leftSection={<IconCheck size={16} />}\n              onClick={() => setApproveModalOpen(true)}\n            >\n              Approve\n            </Button>\n            <Button\n              color=\"red\"\n              leftSection={<IconX size={16} />}\n              onClick={() => setRejectModalOpen(true)}\n            >\n              Reject\n            </Button>\n          </>\n        )}\n\n        {status.is_fully_approved && (\n          <Paper withBorder p=\"sm\" bg=\"green.0\">\n            <Group gap=\"xs\">\n              <IconCheck size={16} color=\"green\" />\n              <Text size=\"sm\" c=\"green.8\" fw={500}>\n                Order can now be placed\n              </Text>\n            </Group>\n          </Paper>\n        )}\n      </Group>\n\n      {/* Status reason if no actions available */}\n      {!status.can_request_approval && !status.user_can_approve && !status.is_fully_approved && (\n        <Text size=\"sm\" c=\"dimmed\">\n          {status.can_request_reason || status.user_can_approve_reason || 'Waiting for approval action'}\n        </Text>\n      )}\n\n      {/* Modals */}\n      <RequestApprovalModal\n        opened={requestModalOpen}\n        onClose={() => setRequestModalOpen(false)}\n        onSuccess={handleSuccess}\n        orderId={orderId}\n        pluginSlug={pluginSlug}\n        isHighValue={status.is_high_value}\n        context={context}\n      />\n\n      <ApprovalDecisionModal\n        opened={approveModalOpen}\n        onClose={() => setApproveModalOpen(false)}\n        onSuccess={handleSuccess}\n        orderId={orderId}\n        pluginSlug={pluginSlug}\n        isApprove={true}\n        context={context}\n      />\n\n      <ApprovalDecisionModal\n        opened={rejectModalOpen}\n        onClose={() => setRejectModalOpen(false)}\n        onSuccess={handleSuccess}\n        orderId={orderId}\n        pluginSlug={pluginSlug}\n        isApprove={false}\n        context={context}\n      />\n    </Stack>\n  );\n}\n","/**\n * InvenTree Approvals Plugin - Frontend Entry Point\n *\n * This file exports the render function that InvenTree's plugin system\n * uses to render the approvals panel.\n *\n * Following the modern InvenTree plugin pattern:\n * - Single argument function that returns a React component\n * - InvenTree wraps the component in MantineProvider and other contexts\n */\n\nimport { checkPluginVersion, type InvenTreePluginContext } from '@inventreedb/ui';\nimport { ApprovalsPanel } from './ApprovalsPanel';\n\n/**\n * Render the approvals panel.\n *\n * This function is called by the InvenTree UI plugin system.\n * It returns a React component that InvenTree will render with proper context.\n *\n * @param context - Plugin context from InvenTree (includes api, user, theme, etc.)\n */\nexport function renderPanel(context: InvenTreePluginContext) {\n  checkPluginVersion(context);\n  return <ApprovalsPanel context={context} />;\n}\n\n/**\n * Check if the panel should be hidden for the given context.\n *\n * @param context - The context data from InvenTree\n * @returns true if the panel should be hidden\n */\nexport function isPanelHidden(context: InvenTreePluginContext): boolean {\n  // Only show for purchase orders\n  return context.model !== 'purchaseorder';\n}\n"],"names":["getStatusBadge","status","formatDate","dateStr","ApprovalHistory","approvals","jsx","Text","rows","approval","index","color","label","jsxs","Table","Badge","Stack","RequestApprovalModal","opened","onClose","onSuccess","orderId","pluginSlug","isHighValue","context","loading","setLoading","useState","error","setError","approvers","setApprovers","selectedApprover","setSelectedApprover","notes","setNotes","useEffect","loadApprovers","params","response","_a","data","err","handleSubmit","approverOptions","user","Modal","LoadingOverlay","Alert","IconAlertCircle","Select","Textarea","e","Group","Button","ApprovalDecisionModal","isApprove","endpoint","ApprovalsPanel","customContext","setStatus","requestModalOpen","setRequestModalOpen","approveModalOpen","setApproveModalOpen","rejectModalOpen","setRejectModalOpen","fetchStatus","useCallback","handleSuccess","Loader","IconAlertTriangle","statusColor","statusText","IconFileDescription","Fragment","IconCheck","IconX","Paper","renderPanel","checkPluginVersion","isPanelHidden"],"mappings":"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"}